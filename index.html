<!DOCTYPE html>

<html lang="fr-FR">

<head>

<script src="./verbs.js"></script>
<script src="./jquery-3.1.1.min.js"></script>
<script src="./jquery.transform2d.js"></script>

<link rel="stylesheet" type="text/css" href="./bootstrap/dist/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="./bootstrap/dist/css/bootstrap-theme.css">
<script src="./bootstrap/dist/js/bootstrap.js"></script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=0.6, minimum-scale=1, user-scalable=yes">

<title>Verbes</title>

<style>

* {
	margin: 0;
	padding: 0;
}

html, body, .main {
	height: 100%;
	width: 100%;
}

//input[type=checkbox] {
	display: none;
}

//label.check:before {
	content: '';
	display: inline-block;
	width: 25px;
	height: 25px;
	margin: 5px 10px;
	border-radius: 50%;
	background-color: white;
	border: 2px solid #444;
	vertical-align: middle;
}

//input[type=checkbox]:checked + label.check:before {
	background-color: #45ab23;
}

label.check {
	margin-left: 10px;
	padding: 3px;
}

.main {
	display: table;
	text-align: center;
	padding: 20px;
}

.wrap {
	display: table-cell;
	vertical-align: middle;
}

.top {
	display: table-cell;
	vertical-align: middle;
}

#verbs-wrap {
	width: 300px;
	margin: auto;
	display: inline-block;
}

.lists {
	text-align: left;
}

.verbs-header {
	padding: 15px;
	font-size: 30px;
	line-height: 30px;
	text-align: center;
	max-width: 300px;
	margin: auto;
}

.verbs-footer {
	padding: 10px;
	text-align: center;
}

button.cb {
	padding: 15px;
	font-size: 22px;
	line-height 22px;
	border-radius: 4px;
	outline: 0;
	background-color: #bbb;
	background-image: none;
	border: 2px solid #aaa;
	-webkit-box-sizing: content-box;
	-moz-box-sizing: content-box;
	box-sizing: content-box;
	margin-bottom: 6px;
}

button.cb:hover {
	cursor: pointer;
	background-color: #aaa;
}

button.cb:active {
	cursor: pointer;
	background-color: #a1a1a1;
}

button.cb:focus {
	border: 2px solid #777;
}

#conj-inf {
	font-size: 20px;
	line-height: 23px;
	text-align: center;
	padding-bottom: 8px;
	margin-bottom: 15px;
	border-bottom: 1px solid #aaa;
}

#conj-inf b {
	font-size: 32px;
	line-height: 50px;
	font-weight: 500;
}

.conj-body {
	display: table;
	table-layout: fixed;
	list-style-type: none;
	margin: auto;
}

.verbr {
	display: table-row;
	padding: 4px;
}

.verbr span {
	display: table-cell;
	vertical-align: middle;
	padding: 5px;
	font-size: 20px;
	line-height: 20px;
	position: relative;
}

.verbr span input {
	padding: 10px;
	font-size: 18px;
	line-height: 18px;
	display: table-cell;
	width: 100%;
	-webkit-appearance: none;
	-webkit-border-radius: 0px;
	border-radius: 0px;
	border: 2px solid #ddd;
	background-color: #fefefe;
}

.verbr span input.wrong {
	border: 2px solid #ef1234;
}

.verbr span input.right {
	border: 2px solid #12ef34;
}

.conj-footer {
	margin-top: 15px;
	border-top: 1px solid #aaa;
	padding: 10px;
}

#categories-list .list-group-item:hover {
	cursor: pointer;
}

#categories-list .list-group-item.checked {
	background-color: #444;
	color: #f4f4f4;
}

.custom-checkbox {
	width: 25px;
	height: 25px;
	display: inline-block;
	vertical-align: middle;
	background-color: #eee;
	border: 3px solid #aaa;
	border-radius: 50%;
	margin-right: 10px;
}

.custom-checkbox:hover {
	cursor: pointer;
}

.custom-checkbox.checked {
	background-color: #444;
}

#categories-list .list-group {
	max-height: 300px;
	overflow: auto;
}

.answer {
	padding-right: 20px !important;
}

.accents-main {
	box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
	border-radius: 8px;
	background-color: #fafafa;
	padding: 8px;
	position: absolute;
	z-index: 100;
	width: 200px;
	top: 30%;
	left: 100%;
	display: none;
	border-top-left-radius: 0px;
}

.accents-main:before {
	position: absolute;
	content: "";
	bottom: 100%;
	left: -16px;
	margin-bottom: -16px;
	border-width: 8px;
	border-style: solid;
	border-color: transparent #fafafa transparent transparent;
}

.accents-list {
	margin: 0;
	list-style-type: none;
	text-align: left;
}

.accents-list .btn {
	display: inline-block;
	margin: 1%;
	width: 22%;
	padding: 5px !important;
	font-size: 18px;
}

.accents-main.active {
	display: block;
}

.accents-main.nope {
	display: none;
}

.accents-main .c {
        display: none;
}

.accents-main.open .c {
        display: inline-block;
}

.accents-main.open .last-accent-first {
        display: none;
}

.accents-main .last-accent-second {
	display: none;
}

.accents-main.open .last-accent-second {
	display: inline-block;
}

.verbr span input:focus {
	outline: 0;
}

.accents-main.active + input {
	box-shadow: 0 0 5px rgba(81, 81, 81, 1);
	border-color: #fefefe;
}

.top-btns {
	position: absolute;
	top: 15px;
	left: 10px;
	width: auto;
	height: auto;
	z-index: 150;
}

.top-btn {
	background-color: #eee;
	border-radius: 5px;
	padding: 10px;
	margin-right: 2px;
	display: none;
	margin-bottom: 6px;
}

.top-btn:hover {
	background-color: #efefef;
	box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 3px 10px 0 rgba(0,0,0,0.19);
	-webkit-transition: background-color .25s, box-shadow .25s;
 	transition: background-color .25s, box-shadow .25s;
	cursor: pointer;
}

.top-btn .tex {
	display: inline-block;
	margin-right: 10px;
}

#modal {
	background-color: rgb(150, 150, 150);
	opacity: 0;
	z-index: 200;
	display: none;
	position: fixed;
	left: 0;
	right: 0;
	top: 0;
	bottom: 0;
}

#modal.active {
	display: block;
	opacity: 0.15;
}

#settings-main {
	position: fixed;
	left: -310px;
	z-index: 300;
	-webkit-transition: left 0.25s;
	transition: left 0.25s;
	width: 300px;
	max-width: 100vw;
	overflow: auto;
	top: 0;
	bottom: 0;
	background-color: #888;
	padding: 25px;
}

.settings-list {
	margin: auto;
	list-style-type: none;
	display: table;
	table-layout: fixed;
	padding: 0px;
	width: 100%;
}

#settings-close {
	text-align: right;
	padding: 0px 0px 25px 25px;
	display: block;
}

#settings-close p {
	text-align: right;
	color: #fff;
	font-size: 18px;
	display: inline;
	padding: 3px;
}

#settings-close p:hover {
	color: #ddd;
	cursor: pointer;
}

#settings-main.active {
	left: 0;
}

.settings-li {
	display: table-row;
}

.settings-li .title {
	font-size: 17px;
	color: white;
	text-align: center;
}

.settings-li .cell {
	display: table-cell;
	padding: 15px;
	position: relative;
	margin-bottom: 30px;
}

.settings-li .dropdown {
	width: 164px;
}

.dropdown-toggle {
	width: 100%;
}

.dropdown-toggle:hover, .dropdown-toggle:focus {
	background-position: 0 0;
}

#verbs-wrap, #conj-wrap, #conj-cong {
	margin-top: 50px;
}

.verb-input {
	padding: 15px 0px;
}

.verb-input input {
	width: 100%;
	padding: 10px;
        font-size: 18px;
        line-height: 18px;
        display: table-cell;
        width: 100%;
        -webkit-appearance: none;
        -webkit-border-radius: 0px;
        border-radius: 0px;
        border: 2px solid #ddd;
        background-color: #fefefe;
}

#no-results {
	text-align: center;
	font-size: 18px;
	color: #444;
	padding: 15px;
}

#settings-accents span {
	padding: 6px;
	font-size: 17px;
	color: white;
}

#settings-accents .cell {
	text-align: center;
}

#settings-accents .custom-checkbox {
	width: 30px;
	height: 30px;
}

#cong-text {
	padding: 15px 15px 5px 15px;
	font-size: 35px;
}

#cong-sub {
	font-size: 25px;
}

#cong-score {
	font-size: 60px;
	padding: 15px;
}

.cong-but {
	text-align: center;
}

.con-but button {
	margin-bottom: 6px;
}

.list-group-item.disabled {
	display: none;
}

.panel-title {
	-webkit-user-select: none;
	-moz-user-select: none;
	user-select: none;
}

.accents-main.temp {
	visibility: hidden;
}

#verbs-go-first {
	padding: 8px 10px;
}

.panel-group.disabled {
	display: none;
}

@media(min-width: 400px) {
	#verbs-go-first {
		display: none;
	}
}

</style>

<script type="text/javascript">

/*
	Tenses:

	0 -> Present
	1 -> Passe compose
	2 -> Futur Simple

*/

var SETTINGS = {
	//random: true,
	subject: -1,
	tense: 0,
	nverbs: 10,
	accents: true
};

var TENSES = [
	"présent",
	"imparfait",
	"passé&nbsp;simple",
	"futur",
	"impératif",
	"conditionnel"
];

window.mobilecheck = function() {
  var check = false;
  (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
  return check;
};

var Latinise={};Latinise.latin_map={"é":"e","à":"a","è":"e","ù":"u","â":"a","ê":"e","î":"i","ô":"o","û":"u","ç":"c","ë":"e","ï":"i","ü":"u"};
String.prototype.latinise=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(a){return Latinise.latin_map[a]||a})};
String.prototype.latinize=String.prototype.latinise;
String.prototype.isLatin=function(){return this==this.latinise()}

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}

function init()
{
	$("#categories-list").empty();
	$("#verbs-list").empty();

	jQuery.extend(jQuery.expr[':'], { vdis: function(el) { return $(this).hasClass("disabled"); } });

	for(var i = 0; i < VERBS.length; i++)
	{
		//console.log("stuff");
		$("#categories-list").append(
			"<div class='panel-group' id='accordion" + i + "' data-cid='" + i + "' data-wtb='0'>" +
                        	"<div class='panel panel-default'>" +
                                	"<div class='panel-heading'>" +
                                        	"<h4 class='panel-title'>" +
                                                	"<div class='custom-checkbox'></div><a class='collapsed' data-toggle='collapse' aria-expanded='false' data-parent='#accordion" + i + "' href='#collapse" + i + "'>" + VERBS[i].cname + "</a>" +
                                                "</h4>" +
                                        "</div>" +
                                        "<div id='collapse" + i + "' class='panel-collapse collapse'>" +
                                        	"<ul class='list-group'></ul>" +
					"</div>" +
				"</div>" +
			"</div>"
		);
	}

	$(".verbr span input").parent().prepend(
"<div class='accents-main'>" +
        "<div class='accents-list'>" +
                "<div class='btn btn-default'>é</div>" +
                "<div class='btn btn-default'>è</div>" +
                "<div class='btn btn-default'>ê</div>" +
                "<div class='btn btn-default'>à</div>" +
                "<div class='btn btn-default'>ç</div>" +
                "<div class='btn btn-default'>û</div>" +
		"<div class='btn btn-default'>â</div>" +
                "<div class='btn btn-default other last-accent-first'><div class='glyphicon glyphicon-chevron-right'></div></div>" +
                "<div class='btn btn-default c'>ä</div>" +
                "<div class='btn btn-default c'>ë</div>" +
                "<div class='btn btn-default c'>î</div>" +
                "<div class='btn btn-default c'>ï</div>" +
                "<div class='btn btn-default c'>ô</div>" +
                "<div class='btn btn-default c'>ù</div>" +
                "<div class='btn btn-default c'>ü</div>" +
                "<div class='btn btn-default c'>œ</div>" +
                "<div class='btn btn-default other last-accent-second'><div class='glyphicon glyphicon-chevron-left'></div></div>" +
        "</div>" +
"</div>");

	if(window.mobilecheck())
	{
		SETTINGS.accents = false;
		$("#accent-check").removeClass("checked");
		$(".accents-main").addClass("nope");
	}

	$(".dropdown-menu li").off("click").click(function() {
		if(!$(this).hasClass("nope"))
		{
			var a = $(this).find("a").html();
			$("#" + this.parentNode.getAttribute("aria-labelledby")).html(a + " <span class='caret'></span>")[0].dataset.val = this.dataset.val;
		}
	});

	window.setTimeout(begin, 100);

	$("#accent-check").click(function() { $(this).toggleClass("checked"); });

	$("#home-btn").click(begin);
	$("#cnew").click(begin);

	var firstBegin = true;

	setInterval(function() {
		if($("#verbs-wrap").css("display") != "none")
		{
			var none = true;
			$("#categories-list .panel-group").each(function() {
				var show = false;

				$(this).find(".list-group-item").each(function() {
					if(!$(this).hasClass("disabled"))
					{
						show = true;
						return false;
					}
				});

				if(!show)
					$(this).addClass("disabled");
				else
					none = false;
			});
	
			if(none)
				$("#no-results").css("display", "block");
			else
				$("#no-results").css("display", "none");
		}
	}, 200);

	function begin()
	{
		$(".panel-title a").off("click").on("click", function(e, s) {
			if(!s)
				this.parentNode.parentNode.parentNode.parentNode.dataset.wtb = !parseInt(this.parentNode.parentNode.parentNode.parentNode.dataset.wtb);
		});

		function updateSettings()
        	{
                	var s = parseInt($("#dropdownMenu1")[0].dataset.val);
                	var t = parseInt($("#dropdownMenu2")[0].dataset.val);

			if(t === -1)
                        {
                                t = Math.floor(Math.random() * (TENSES.length - 0.01));
                        }
			else if(t != SETTINGS.tense)
			{
				$("#conj-inf").html("<b>" + $("#conj-inf b").html() + "</b><br>" + TENSES[t]);
			}

			SETTINGS.accents = $("#accent-check").hasClass("checked");
                        if(!SETTINGS.accents)
                                $(".accents-main").addClass("nope");
                        else
                                $(".accents-main").removeClass("nope");

			if(s != SETTINGS.subject && $("#conj-wrap").css("display") != "none")
			{
				SETTINGS.subject = s;
                        	SETTINGS.tense = t;
				beginVerbs();
				return;
			}

			SETTINGS.subject = s;
			SETTINGS.tense = t;
		}

		updateSettings();

		$("#modal").off("click").click(function(e) {
			if(e.pageX > $("#settings-main").width())
			{
               		 	updateSettings();
                		//console.log("j");
				$("#settings-main").removeClass("active");
                		$("#modal").removeClass("active");
        		}
		});

		$("#verbs-wrap").css("display", "inline-block");
		$("#conj-cong").css("display", "none");
                $("#conj-wrap").css("display", "none").css("opacity", "0");

		$("#settings-btn").off("click").click(function(e) {
			$("#settings-main").addClass("active");
			$("#modal").addClass("active");
			//e.stopPropagation();
		});

		$("#settings-close p").off("click").click(function() {
			updateSettings();
			$("#settings-main").removeClass("active");
			$("#modal").removeClass("active");
		});

		if(firstBegin)
		{
			$("#categories-list .panel-group").each(function() {
				for(var i = 0; i < VERBS[this.dataset.cid].verbs.length; i++)
					$(this).find(".list-group").append("<li class='list-group-item' data-cid='" + this.dataset.cid + "' data-vid='" + i + "'>" + VERBS[this.dataset.cid].verbs[i].inf + "</li>");
			});
			firstBegin = false;
		}

		$(".verbr span input").off("focus").focus(function() {
			$(".accents-main").removeClass("active");
			$(this).prev().addClass("active");
		});

		$(".conj-footer button").off("focus").focus(removeA);
		$("html").off("click").click(removeA);
		//$("#settings-main").off("click").click(function(e) { e.stopPropagation(); });
		$(".accents-main").off("click").click(function(e) { e.stopPropagation(); });
		$(".verbr span input").off("click").click(function(e) { e.stopPropagation(); });

		function removeA()
		{
			$(".accents-main").removeClass("open").removeClass("active");

			/*if($("#settings-main").hasClass("active") || $("#modal").hasClass("active"))
			{
				updateSettings();
				$("#settings-main").removeClass("active");
				$("#modal").removeClass("active");
			}*/
		}

		/*$(".verbr span input").blur(function() {
			$(this).prev().removeClass("active");
		});

		$(".verbr span input").blur(function() {
			var e = $(this).prev();
			if(!e.find("li:focus").length)
				e.removeClass("active");
		});*/

		$(".accents-main .btn").off("click").click(function() {
			$(this).blur().parent().parent().parent().find("input").focus();
			if(!$(this).hasClass("other"))
			{
				var inp = this.parentNode.parentNode.nextSibling;
				inp.value = inp.value + this.innerHTML;
			}
		});

		/*$(".accents-main .btn").each(function() {
			this.removeAttribute("tabIndex");
		});*/

		$(".accents-main .last-accent-first").off("click").click(function() {
			$(this).parent().parent().addClass("open");
		});

		$(".accents-main .last-accent-second").off("click").click(function() {
                        $(this).parent().parent().removeClass("open");
                });

		$("#categories-list .panel-title .custom-checkbox").off("click").click(function() {
                        var c = this.parentNode.parentNode.parentNode.parentNode.dataset.cid;
			var t = !$(this).hasClass("checked");
			$(this).toggleClass("checked");

			if(t)
			{
                        	$(this.parentNode.parentNode.parentNode).find(".list-group .list-group-item").each(function() {
					//if($(this).css("display") != "none")
						$(this).addClass("checked");
				});
			}
                	else
			{
				$(this.parentNode.parentNode.parentNode).find(".list-group .list-group-item").each(function() {
					//if($(this).css("display") != "none")
						$(this).removeClass("checked");
				});
			}
		});

		$("#categories-list .list-group-item").off("click").click(function() {
			$(this).toggleClass("checked");

			var all = true;
			$(this.parentNode).find(".list-group-item").each(function() {
				if(!$(this).hasClass("checked"))// && $(this).css("display") != "none")
				{
					all = false;
					return false;
				}
			});
//console.log(this.parentNode.parentNode);
			if(all)
				$(this.parentNode.parentNode.parentNode).find(".custom-checkbox").addClass("checked");
			else
				$(this.parentNode.parentNode.parentNode).find(".custom-checkbox").removeClass("checked");
		});

		$(".verbs-go").off("click").click(beginVerbs);
		$("#restart-btn").off("click").click(function() {
			if($("#verbs-wrap").css("display") == "none")
				beginVerbs();
		});
		$("#crestart").off("click").click(beginVerbs);		

		var score = 0;
		var maxscore = 0;

		function beginVerbs()
		{
			//updateSettings();

			var tverbs = [];
			score = 0;
			maxscore = 0;

			$("#categories-list .list-group-item").each(function() {
				if($(this).hasClass("checked"))
					tverbs.push(VERBS[this.dataset.cid].verbs[this.dataset.vid]);
			});

			if(!tverbs.length)
			{
				alert("Choisissez quelques verbes");
				return;
			}

			//if(SETTINGS.random)
			shuffle(tverbs);

			$("#verbs-wrap").css("display", "none");
			$("#conj-cong").css("display", "none");
			$("#conj-wrap").css("display", "inline-block");

			var vidx = -1;
			var wrong = false;
			function nextVerb(shouldntanimate)
			{
				vidx++;

				if(vidx >= tverbs.length)
                                {
                                        $("#conj-form").off("submit");
                                        $("#conj-wrap").stop().animate({ opacity: "0" }, 200, function() {
						$("#conj-wrap").css("display", "none");
						
						if(maxscore)
						{
							var p = parseInt(100 * score / maxscore);
							$("#cong-score").html(p + "%");
							if(p <= 20)
								$("#cong-text").html("Mauvaise chance!");
							else if(p <= 40)
								$("#cong-text").html("Pas mal!");
							else if(p <= 60)
               	                                         	$("#cong-text").html("Bien!");
							else if(p <= 80)
               	                                         	$("#cong-text").html("Très bien!");
							else
								$("#cong-text").html("Parfait!");
						}
						else
						{
							$("#cong-text").html("Mauvaise chance!");
							$("#cong-score").html("0%");
						}

						$("#conj-cong").css("display", "inline-block").css("opacity", "0").animate({ opacity: "1" }, 200);
					});

		                     	return;
				}
                                else
                                {
					if(!shouldntanimate)
						$("#conj-wrap").stop().animate({ opacity: "0" }, 200, gorest)
					else {
				//		console.log(shouldntanimate);
						gorest();
					}

					function gorest()
					{				
					$(".accents-main").removeClass("temp");
	
					$(".verbr span input").removeClass("wrong").removeClass("right").val("");
       	                                $("#conj-try").css("display", "none");
					$("#conj-next").css("display", "none");
					$("#conj-submit").css("display", "inline-block");
               	                        wrong = false;
					$("#conj-inf").html("<b>" + tverbs[vidx].inf + "</b><br>" + TENSES[SETTINGS.tense]);
					$(".conj-body .answer").html("");

					$(".conj-body .verbr").css("display", "table-row");

					$("#conj-wrap").stop().animate({ opacity: "1" }, 200, function() {
                                        //        console.log("focus");
						if(SETTINGS.subject == -1)
						{ 
				               		$("#conj-all .verbr span input").each(function() {
								if($(this.parentNode.parentNode).css("display") != "none")
								{
									$(this).focus();
									return false;
								}
							});
						}
						else
						{
							$("#conj-one .verbr span input").first().focus();
						}
                                        });

					var su = ["Je/J'", "Tu", "Il", "Elle", "Nous", "Vous", "Ils", "Elles"];
					/*var a = [[0, 1, 2, 4, 5, 6],
						 [0, 1, 2, 3, 4, 5, 6, 7],
						 [2];
					];*/

					// Random single subject
					if(SETTINGS.subject === -2)
       	                 		{
						var s = Math.floor(Math.random() * (su.length - 0.01));
						if(tverbs[vidx].tenses[SETTINGS.tense][s] === "")
						{
							var arr = [];

							for(var i = 0; i < tverbs[vidx].tenses[SETTINGS.tense].length; i++)
								if(tverbs[vidx].tenses[SETTINGS.tense][i] !== "")
									arr.push(i);

							if(!arr.length)
							{
								$("#conj-wrap").stop();
								nextVerb("y");
								return;
							}
							else {
								s = arr[Math.floor(Math.random() * (arr.length - 0.01))];
								//console.log(s);
							}
						}

						//var sub = s;

						/*if(tverbs[vidx].tenses.ex && tverbs[vidx].tenses.ex.length)
						{
							var e = tverbs[vidx].tenses.ex;
							// first - which tense (-1 is all), second - which collection of subjects (a)
							for(var i = 0; i < e.length; i++)
							{
								if((e[i][0] == -1 || SETTINGS.tense == e[i][0]))
								{
									sub = a[e[i][1]].indexOf(s);
									if(sub === -1)
									{
										$("#conj-wrap").stop();
										nextVerb("y");
										return;
									}

									break;
								}
							}
						}*/

                	                	$("#conj-one .verbr span")[0].innerHTML = su[s];
						$("#conj-one .verbr span input")[0].dataset.subj = s;
					
						$("#conj-all").css("display", "none");
	
						//$("#conj-allc").css("display", "none");
                	                        $("#conj-one").css("display", "table");
                        		}
					// All subjects
					else if(SETTINGS.subject === -1)
					{
						//if(SETTINGS.tense === 0)
						//{
						//	$("#conj-allc").css("display", "table");
						//	$("#conj-all").css("display", "none");
						//}
						//else
						//{
						$("#conj-all").css("display", "table");
						//	$("#conj-allc").css("display", "none");
						//}

						/*$("#conj-all .verbr").each(function(id) {
							if(a[0].length > id)
								this.dataset.subj = a[0][id];
							else
								$(this).css("display", "none");
						});*/

						/*if(tverbs[vidx].tenses.ex && tverbs[vidx].tenses.ex.length)
                                                {
                                                        var e = tverbs[vidx].tenses.ex;
                                                        // first - which tense (-1 is all), second - which collection of subjects (a)
                                                        for(var i = 0; i < e.length; i++)
                                                        {
                                                                if(e[i][0] == -1 || SETTINGS.tense == e[i][0])
                                                                {
									for(var j = 0; j < a[e[i][1]].length; j++)
									{
										if(
									}

									break;
                                                                }
                                                        }
                                                }*/

						var s = 0;
						$("#conj-all .verbr").each(function(id) {
							if(tverbs[vidx].tenses[SETTINGS.tense][id] === "")
							{
								$(this).css("display", "none");
								s++;
							}
						});

						if(!s)
						{
							$("#conj-wrap").stop();
							nextVerb("y");
							return;
						}

						$("#conj-one").css("display", "none");
					}
					else
					{
						var sub = SETTINGS.subject;
						var subname = su[sub];

						if(tverbs[vidx].tenses[SETTINGS.tense][SETTINGS.subject] === "")
						{
							if(SETTINGS.subject === 3 && tverbs[vidx].tenses[SETTINGS.tense][2] !== "")
							{
								sub = 2;
								subname = "Elle";
							}
							else if(SETTINGS.subject === 7 && tverbs[vidx].tenses[SETTINGS.tense][6] !== "")  
                                                        {
                                                                sub = 6;
                                                                subname = "Elles";
                                                        }
							else
							{
								$("#conj-wrap").stop();
								nextVerb("y");
								return;
							}
						}

						$("#conj-one .verbr span")[0].innerHTML = "<b>" + subname + "</b>";
						$("#conj-one .verbr span input")[0].dataset.subj = sub;
				
	                                        $("#conj-all").css("display", "none");
       	                	                //$("#conj-allc").css("display", "none");
       	        	                        $("#conj-one").css("display", "table");
					}
					}
				}
			}

			nextVerb();
			$("#conj-form").submit(function(e) {
				e.preventDefault();

				$(".verbr span input").blur();

				var w = 0;
				var t = 0;
				if(SETTINGS.subject === -1)
				{
					$("#conj-all .verbr span input").each(function() {
						if($(this).css("display") != "none")
						{
							$(this).parent().prev().html(tverbs[vidx].tenses[SETTINGS.tense][this.dataset.subj]);

							t++;
							if(this.value.replace(" " , "").replace("	", "").toLowerCase() !== tverbs[vidx].tenses[SETTINGS.tense][this.dataset.subj].toLowerCase()) {
								$(this).addClass("wrong");
								w++;
							}
							else
								$(this).addClass("right");
						}
					});
				}
				else
				{
					var input = $("#conj-one .verbr span input")[0];

					t++;
					$(input).parent().prev().html(tverbs[vidx].tenses[SETTINGS.tense][input.dataset.subj]);

					if(input.value.replace(" " , "").replace("	", "").toLowerCase() !== tverbs[vidx].tenses[SETTINGS.tense][input.dataset.subj].toLowerCase()) {
						$(input).addClass("wrong");
						w++;
					}
					else
						$(input).addClass("right");
				}

				$(".accents-main").addClass("temp");

				score += t - w;
				maxscore += t;

				//console.log(score + "   " + maxscore);

				$("#conj-submit").css("display", "none");

				$("#conj-try").css("display", "inline-block").off("click").click(function() {
					vidx--;
					nextVerb();
				});

				$("#conj-next").css("display", "inline-block").focus().off("click").click(function() { nextVerb(); });
			});
		}
	}

	$(window).resize(re);

	re();
	$(".top-btn").css("display", "inline-block");

        function re() 
        {
                if($(document).width() < 400)
                        $(".top-btn .tex").css("display", "none");
                else
                        $(".top-btn .tex").css("display", "inline-block");
        }
}

function searchVerbs()
{
	var inp = $(".verb-input input")[0];
	
	function triggerToggle(a)
	{
		var ja = $(a);
		if(ja.attr("aria-expanded") == "true")
		{
			ja.addClass("collapsed").attr("aria-expanded", "false");
			$(a.parentNode.parentNode.nextSibling).removeClass("in").attr("aria-expanded", "false");
		}
		else
		{
			ja.removeClass("collapsed").attr("aria-expanded", "true");
                        $(a.parentNode.parentNode.nextSibling).addClass("in").attr("aria-expanded", "true").css("height", "auto");
		}
	}

	if(inp.value === "")
	{
		$("#categories-list .panel-group").removeClass("disabled").each(function() {
			var a = $(this).find(".panel-title a");

			if(a.hasClass("collapsed") && parseInt(this.dataset.wtb) === 1)
				triggerToggle(a[0]);
			else if(!a.hasClass("collapsed") && parseInt(this.dataset.wtb) === 0)
				triggerToggle(a[0]);

				var all = true;
        	        	$(this).find(".list-group-item").each(function() {
        	                	if(!$(this).hasClass("checked"))
               	                 	{
               	                	        all = false;
               	        	        	return false;
               		                }
                        	});

                        	if(all)
                                	$(this).find(".custom-checkbox").addClass("checked");
                        	else
                                	$(this).find(".custom-checkbox").removeClass("checked");
		});
		
		$("#categories-list .list-group-item").removeClass("disabled");
	}
	else
	{
		$("#categories-list .list-group-item").each(function() {
			var s = VERBS[this.dataset.cid].verbs[this.dataset.vid].inf.toLowerCase().latinize();
			var ss = inp.value.toLowerCase().latinize();
			if(s.substr(0, ss.length) != ss)
			{
				$(this).addClass("disabled");
			
				/*var p = $(this.parentNode);
				if(p.find(".list-group-item:vdis").length === p[0].children.length)
					p.parent().parent().parent().css("display", "none");*/

				/*var v = false;
				var all = true;
				for(var i = 0; i < this.parentNode.children.length; i++)
				{
					if($(this.parentNode.children[i]).css("display") != "none")
					{
						v = true;
						if(!$(this.parentNode.children[i]).hasClass("checked"))
						{
							all = false;
							break;
						}
					}
				}

				if(all)
                                	$(this.parentNode.parentNode.parentNode).find(".custom-checkbox").addClass("checked");
                        	else
                                	$(this.parentNode.parentNode.parentNode).find(".custom-checkbox").removeClass("checked");

				if(!v)
				{
					$(this.parentNode.parentNode.parentNode.parentNode).css("display", "none");
					var nv = true;
					$("#categories-list .panel-group").each(function() {
						if($(this).css("display") != "none")
						{
							nv = false;
							return false;
						}
					});
					if(nv)
						$("#no-results").css("display", "block");
					else
						$("#no-results").css("display", "none");
				}*/
			}
			else
			{
				$(this).removeClass("disabled");
				$(this.parentNode.parentNode.parentNode.parentNode).removeClass("disabled");

				var a = $(this.parentNode.parentNode.previousSibling).find(".panel-title a");
				if(a.hasClass("collapsed"))
					triggerToggle(a[0]);
			}
		});
	}
}

</script>

</head>

<body onload="init()">

<div class="top-btns">
	<div class="top-btn" id="settings-btn">
		<div class="tex">Paramètres</div>
		<span class="glyphicon glyphicon-cog"></span>
	</div>
	<div class="top-btn" id="restart-btn">
		<div class="tex">Recommencer</div>
		<span class="glyphicon glyphicon-repeat"></span>
	</div>
	<div class="top-btn" id="home-btn">
                <div class="tex">Accueil</div>
                <span class="glyphicon glyphicon-home"></span>
        </div>
</div>

<div id="settings-main">
	<div id="settings-close"><p>Fermer</p></div>
	<ul class="settings-list">
		<li class="settings-li" id="settings-subject">
			<span class="title cell">Sujet:</span>
			<div class="dropdown cell">
  				<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-val="-2">Arbitraire
    					<span class='caret'></span>
  				</button>
				<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
					<li data-val="-2"><a href="#">Arbitraire</a></li>
					<li data-val="-1"><a href="#">Tous les sujets</a></li>
					<li role="separator" class="nope divider"></li>
    					<li data-val="0"><a href="#">Je</a></li>
					<li data-val="1"><a href="#">Tu</a></li>
					<li data-val="2"><a href="#">Il</a></li>
					<li data-val="3"><a href="#">Elle</a></li>
					<li data-val="4"><a href="#">Nous</a></li>
					<li data-val="5"><a href="#">Vous</a></li>
					<li data-val="6"><a href="#">Ils</a></li>
					<li data-val="7"><a href="#">Elles</a></li>
				</ul>
			</div>
		</li>
		 <li class="settings-li" id="settings-subject">
                        <span class="title cell">Temps:</span>
                        <div class="dropdown cell">
                                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-val="-1">Arbitraire
                                        <span class='caret'></span>
                                </button>
                                <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                                        <li data-val="-1"><a href="#">Arbitraire</a></li>
                                        <li role="separator" class="nope divider"></li>
					<li data-val="0"><a href="#">Présent</a></li>
					<li data-val="1"><a href="#">Imparfait</a></li>
					<li data-val="2"><a href="#">Passé simple</a></li>
					<li data-val="3"><a href="#">Futur</a></li>
					<li data-val="4"><a href="#">Impératif</a></li>
					<li data-val="5"><a href="#">Conditionnel</a></li>
                                </ul>
                        </div>
                </li>
		<li class="settings-li" id="settings-accents">
			<span class="cell">La&nbsp;fênetre des&nbsp;accents</span>
			<div class="cell"><div class="custom-checkbox checked" id="accent-check"></div></div>
		</div>
	</ul>	
</div>

<div id="modal">
	
</div>

<div class="main">
	<div class="wrap">
		<div id="verbs-wrap">
			<div class="verbs-header">
				Choisissez les verbes que vous voulez réviser
			</div>
			<div class="verbs-footer">
                                <button class="cb verbs-go" id="verbs-go-first">Commencer!</button>
                        </div>
			<div class="verb-input">
				<input type="text" placeholder="Chercher" oninput="searchVerbs()"></input>
			</div>
			<div id="no-results" style="display:none">
				Il n'y a pas de verbes avec cette recherche
			</div>
			<div class="lists" id="categories-list">
			</div>
			<div class="verbs-footer">
				<button class="cb verbs-go">Commencer!</button>
			</div>
		</div>
		<div id="conj-cong" style="display:none">
			<div id="cong-text">Bien!</div>
			<div id="cong-score">80%</div>
			<div class="cong-but">
				<button id="crestart" class="cb">Recommencer</button>
				<button id="cnew" class="cb">Nouveaux verbes</button>
			</div>
		</div>
		<div id="conj-wrap" style="display:none; opacity: 0">
			<div id="conj-inf"></div>
			<div class="conj-conj">
				<form id="conj-form">
				<ul id="conj-subjects">
					<div class="conj-body" id="conj-all" style="display:none">
                                                <li class="verbr">
                                                        <span><b>Je/J'</b></span>
							<span class="answer"></span>
							<span><input type="text" data-subj="0"></span>
                                                </li>
                                                <li class="verbr">
                                                        <span><b>Tu</b></span>
							<span class="answer"></span>
                                                        <span><input type="text" data-subj="1"></span>
                                                </li>
                                                <li class="verbr">
                                                        <span><b>Il</b></span>
							<span class="answer"></span>
                                                        <span><input type="text" data-subj="2"></span>
                                                </li>
						<li class="verbr">
                                                        <span><b>Elle</b></span>
                                                        <span class="answer"></span>
                                                        <span><input type="text" data-subj="3"></span>
                                                </li>
                                                <li class="verbr">
                                                        <span><b>Nous</b></span>
							<span class="answer"></span>
                                                        <span><input type="text" data-subj="4"></span>
                                                </li>
                                                <li class="verbr">
                                                        <span><b>Vous</b></span>
							<span class="answer"></span>
                                                        <span><input type="text" data-subj="5"></span>
                                                </li>
                                                <li class="verbr">
                                                        <span><b>Ils</b></span>
							<span class="answer"></span>
                                                        <span><input type="text" data-subj="6"></span>
                                                </li>
						<li class="verbr">
                                                        <span><b>Elles</b></span>
                                                        <span class="answer"></span>
                                                        <span><input type="text" data-subj="7"></span>
                                                </li>
                                        </div>
					<div class="conj-body" id="conj-one" style="display:none">
						<li class="verbr">
							<span><b></b></span>
							<span class="answer"></span>
							<span><input type="text"></span>
						</li>
					</div>
				</ul>
				</form>
			</div>
			<div class="conj-footer">
				<button class="cb" id="conj-try" style="display:none">Refaire</button>
				<button class="cb" id="conj-submit" form="conj-form">Corriger les responses</button>
				<button class="cb" id="conj-next" style="display:none">Prochain</button>
			</div>
		</div>
	</div>	
</div>

</body>

</html>
